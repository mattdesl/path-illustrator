(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var createApp=require("../");var isUndo=require("is-undo-redo").undo;var isRedo=require("is-undo-redo").redo;var domify=require("domify");var style=require("dom-style");var events=require("dom-events");var classes=require("dom-classes");var buttonHTML='<div class="button"></div>';var css=".button {\n	width: 16px;\n	height: 16px;\n	display: inline-block;\n	margin: 10px;\n	opacity: 0.5;\n	background-repeat: no-repeat;\n	background-position: center center;\n}\n.button:hover {\n	opacity: 1.0;\n	cursor: pointer;\n}\n.button.selected {\n	opacity: 1.0;\n	cursor: auto;\n}\n\n.button.pencil_remove {\n	background-image: url(pencil_remove.png);\n}\n.button.pencil_add {\n	background-image: url(pencil_add.png);\n}\n.button.pencil {\n	background-image: url(pencil.png);\n}\n.button.curve {\n	background-image: url(curve.png);\n}\n.button.pointer {\n	background-image: url(pointer.png);\n}\n.button.pointer_fill {\n	background-image: url(pointer_fill.png);\n}\n.button.undo {\n	background-image: url(undo.png);\n}\n.button.redo {\n	background-image: url(redo.png);\n}\n.button.clear {\n	background-image: url(clear.png);\n}\n.toolbar {\n	position: static;\n	top: 0px;\n	left: 0px;\n	width: 100%;\n	height: 36px;\n	line-height: 36px;\n	background: #e8e8e8;\n	border-bottom: 1px solid #c1c1c1;\n}\n\ncanvas {\n	position: absolute;\n	top: 36px;\n	left: 0;\n}";require("insert-css")(css);require("canvas-testbed")(render,start);var app;function render(ctx,width,height){ctx.clearRect(0,0,width,height);ctx.globalAlpha=1;app.draw(ctx)}function start(ctx,width,height){ctx.canvas.onselectstart=function(){return false};ctx.canvas.oncontextmenu=function(e){e.preventDefault()};app=createApp({element:ctx.canvas,fillStyle:"black",fillAlpha:.3});app.path.on("change",function(){});app.path.on("finish-change",function(){console.log("path changed")});events.on(window,"keydown",function(ev){if(isUndo(ev)){ev.preventDefault();app.undo()}else if(isRedo(ev)){ev.preventDefault();app.redo()}});addButtons()}function addButtons(){var names=["pencil","curve","pointer","undo","redo","clear"];var toolbar=document.createElement("div");document.body.appendChild(toolbar);classes.add(toolbar,"toolbar");names.forEach(function(n){var img=new Image;img.src=n+".png"});var states={pencil:function(app){app.path.showAllControls=false;app.path.drawing=true;app.path.allowAdd=true;app.path.allowRemove=true},curve:function(app){app.path.showAllControls=true;app.path.drawing=true;app.path.allowAdd=true;app.path.allowRemove=true},pointer:function(app){app.path.showAllControls=false;app.path.drawing=false;app.path.allowAdd=false;app.path.allowRemove=false},clear:function(app){app.clear()},undo:function(app){return app.undo()},redo:function(app){return app.redo()}};var curState=states.pencil;var buttons=names.map(function(s,i){var div=domify(buttonHTML);classes.add(div,s);if(i===0)classes.add(div,"selected");toolbar.appendChild(div);events.on(div,"click",function(target,name,ev){var trigger=["undo","redo","clear"].indexOf(name)!==-1;if(!trigger){buttons.forEach(function(b){classes.remove(b,"selected")});classes.add(target,"selected");curState=states[name];curState(app)}else if(name in states){states[name](app)}}.bind(this,div,s));return div});function icon(div,name){classes.remove(div,/(pencil|pointer).*/);classes.add(div,name)}events.on(window,"keydown",function(ev){if(curState===states.pointer){if(ev.metaKey||ev.ctrlKey){icon(buttons[2],"pointer_fill")}else icon(buttons[2],"pointer")}else if(ev.altKey){icon(buttons[0],"pencil_remove")}});events.on(window,"keyup",function(ev){icon(buttons[2],"pointer");icon(buttons[0],"pencil")});events.on(window,"mousemove",function(ev){if(curState!==states.pointer){var defIcon=ev.altKey?"pencil_remove":"pencil";icon(buttons[0],app.path.pointOnPath?"pencil_add":defIcon)}})}},{"../":2,"canvas-testbed":3,"dom-classes":8,"dom-events":10,"dom-style":14,domify:18,"insert-css":19,"is-undo-redo":20}],2:[function(require,module,exports){var createPath=require("path-illustrator-client/index");var createClient=require("path-illustrator-client/client");var createTools=require("path-illustrator-client/tools");function App(opt){if(!(this instanceof App))return new App(opt);opt=opt||{};var tools=createTools.map(function(t){return t()});this.path=createPath(opt);this.client=createClient(this.path,opt);this.client.tool=tools[0];this.undo=this.client.undo.bind(this.client);this.redo=this.client.redo.bind(this.client);this.clear=this.client.clear.bind(this.client);this.draw=this.path.draw.bind(this.path)}Object.defineProperty(App.prototype,"renderer",{get:function(){return this.path.renderer},set:function(renderer){this.path.renderer=renderer}});module.exports=App},{"path-illustrator-client/client":21,"path-illustrator-client/index":23,"path-illustrator-client/tools":46}],3:[function(require,module,exports){var domready=require("domready");require("raf.js");var CanvasApp=require("canvas-app");module.exports=function(render,start,options){domready(function(){if(typeof render==="object"&&render){options=render;render=null;start=null}else if(typeof start==="object"&&start){options=start;start=null}options=options||{};if(typeof options.onReady!=="function")options.onReady=start;var runner=CanvasApp(render,options);runner.canvas.setAttribute("id","canvas");document.body.appendChild(runner.canvas);document.body.style.margin="0";document.body.style.overflow="hidden";runner.start()})}},{"canvas-app":4,domready:6,"raf.js":7}],4:[function(require,module,exports){var getGL=require("webgl-context");function CanvasApp(render,options){if(!(this instanceof CanvasApp))return new CanvasApp(render,options);if(typeof render==="object"&&render){options=render;render=null}render=typeof render==="function"?render:options.onRender;options=options||{};options.retina=typeof options.retina==="boolean"?options.retina:true;var hasWidth=typeof options.width==="number",hasHeight=typeof options.height==="number";if(hasWidth||hasHeight)options.ignoreResize=true;options.width=hasWidth?options.width:window.innerWidth;options.height=hasHeight?options.height:window.innerHeight;var DPR=options.retina?window.devicePixelRatio||1:1;var canvas=options.canvas||document.createElement("canvas");canvas.width=options.width*DPR;canvas.height=options.height*DPR;if(options.retina){canvas.style.width=options.width+"px";canvas.style.height=options.height+"px"}var context,attribs=options.contextAttributes||{};this.isWebGL=false;if(options.context==="webgl"||options.context==="experimental-webgl"){context=getGL({canvas:canvas,attributes:attribs});if(!context){throw"WebGL Context Not Supported -- try enabling it or using a different browser"}this.isWebGL=true}else{context=canvas.getContext(options.context||"2d",attribs)}this.running=false;this.width=options.width;this.height=options.height;this.canvas=canvas;this.context=context;this.onResize=options.onResize;this._DPR=DPR;this._retina=options.retina;this._once=options.once;this._ignoreResize=options.ignoreResize;this._lastFrame=null;this._then=Date.now();this.fps=60;this._frames=0;this._prevTime=this._then;if(!this._ignoreResize){window.addEventListener("resize",function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this));window.addEventListener("orientationchange",function(){this.resize(window.innerWidth,window.innerHeight)}.bind(this))}if(typeof render==="function"){this.onRender=render.bind(this)}else{this.onRender=function(context,width,height,dt){}}this.renderOnce=function(){var now=Date.now();var dt=now-this._then;this._frames++;if(now>this._prevTime+1e3){this.fps=Math.round(this._frames*1e3/(now-this._prevTime));this._prevTime=now;this._frames=0}if(!this.isWebGL){this.context.save();this.context.scale(this._DPR,this._DPR)}this.onRender(this.context,this.width,this.height,dt);if(!this.isWebGL)this.context.restore();this._then=now};this._renderHandler=function(){if(!this.running)return;if(!this._once){this._lastFrame=requestAnimationFrame(this._renderHandler)}this.renderOnce()}.bind(this);if(typeof options.onReady==="function"){options.onReady.call(this,context,this.width,this.height)}}Object.defineProperty(CanvasApp.prototype,"retinaEnabled",{set:function(v){this._retina=v;this._DPR=this._retina?window.devicePixelRatio||1:1;this.resize(this.width,this.height)},get:function(){return this._retina}});CanvasApp.prototype.resetFPS=function(){this._frames=0;this._prevTime=Date.now();this._then=this._prevTime;this.fps=60};CanvasApp.prototype.start=function(){if(this.running)return;if(this._lastFrame)cancelAnimationFrame(this._lastFrame);this.resetFPS();this.running=true;this._lastFrame=requestAnimationFrame(this._renderHandler)};CanvasApp.prototype.stop=function(){if(this._lastFrame){cancelAnimationFrame(this._lastFrame);this._lastFrame=null}this.running=false};CanvasApp.prototype.resize=function(width,height){var canvas=this.canvas;this.width=width;this.height=height;canvas.width=this.width*this._DPR;canvas.height=this.height*this._DPR;if(this._retina){canvas.style.width=this.width+"px";canvas.style.height=this.height+"px"}if(this._once)requestAnimationFrame(this._renderHandler);if(typeof this.onResize==="function")this.onResize(this.width,this.height)};module.exports=CanvasApp},{"webgl-context":5}],5:[function(require,module,exports){module.exports=function(opts){opts=opts||{};var canvas=opts.canvas||document.createElement("canvas");if(typeof opts.width==="number")canvas.width=opts.width;if(typeof opts.height==="number")canvas.height=opts.height;var attribs=opts.attributes||opts.attribs||{};try{gl=canvas.getContext("webgl",attribs)||canvas.getContext("experimental-webgl",attribs)}catch(e){gl=null}return gl}},{}],6:[function(require,module,exports){!function(name,definition){if(typeof module!="undefined")module.exports=definition();else if(typeof define=="function"&&typeof define.amd=="object")define(definition);else this[name]=definition()}("domready",function(){var fns=[],listener,doc=document,domContentLoaded="DOMContentLoaded",loaded=/^loaded|^c/.test(doc.readyState);if(!loaded)doc.addEventListener(domContentLoaded,listener=function(){doc.removeEventListener(domContentLoaded,listener);loaded=1;while(listener=fns.shift())listener()});return function(fn){loaded?fn():fns.push(fn)}})},{}],7:[function(require,module,exports){(function(window){var lastTime=0,vendors=["webkit","moz"],requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,i=vendors.length;while(--i>=0&&!requestAnimationFrame){requestAnimationFrame=window[vendors[i]+"RequestAnimationFrame"];cancelAnimationFrame=window[vendors[i]+"CancelAnimationFrame"]}if(!requestAnimationFrame||!cancelAnimationFrame){requestAnimationFrame=function(callback){var now=+new Date,nextTime=Math.max(lastTime+16,now);return setTimeout(function(){callback(lastTime=nextTime)},nextTime-now)};cancelAnimationFrame=clearTimeout}window.requestAnimationFrame=requestAnimationFrame;window.cancelAnimationFrame=cancelAnimationFrame})(window)},{}],8:[function(require,module,exports){var index=require("indexof");var whitespaceRe=/\s+/;var toString=Object.prototype.toString;module.exports=classes;module.exports.add=add;module.exports.contains=has;module.exports.has=has;module.exports.toggle=toggle;module.exports.remove=remove;module.exports.removeMatching=removeMatching;function classes(el){if(el.classList){return el.classList}var str=el.className.replace(/^\s+|\s+$/g,"");var arr=str.split(whitespaceRe);if(""===arr[0])arr.shift();return arr}function add(el,name){if(el.classList){el.classList.add(name);return}var arr=classes(el);var i=index(arr,name);if(!~i)arr.push(name);el.className=arr.join(" ")}function has(el,name){return el.classList?el.classList.contains(name):!!~index(classes(el),name)}function remove(el,name){if("[object RegExp]"==toString.call(name)){return removeMatching(el,name)}if(el.classList){el.classList.remove(name);return}var arr=classes(el);var i=index(arr,name);if(~i)arr.splice(i,1);el.className=arr.join(" ")}function removeMatching(el,re,ref){var arr=Array.prototype.slice.call(classes(el));for(var i=0;i<arr.length;i++){if(re.test(arr[i])){remove(el,arr[i])}}}function toggle(el,name){if(el.classList){return el.classList.toggle(name)}if(has(el,name)){remove(el,name)}else{add(el,name)}}},{indexof:9}],9:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],10:[function(require,module,exports){var synth=require("synthetic-dom-events");var on=function(element,name,fn,capture){return element.addEventListener(name,fn,capture||false)};var off=function(element,name,fn,capture){return element.removeEventListener(name,fn,capture||false)};var once=function(element,name,fn,capture){function tmp(ev){off(element,name,tmp,capture);fn(ev)}on(element,name,tmp,capture)};var emit=function(element,name,opt){var ev=synth(name,opt);element.dispatchEvent(ev)};if(!document.addEventListener){on=function(element,name,fn){return element.attachEvent("on"+name,fn)}}if(!document.removeEventListener){off=function(element,name,fn){return element.detachEvent("on"+name,fn)}}if(!document.dispatchEvent){emit=function(element,name,opt){var ev=synth(name,opt);return element.fireEvent("on"+ev.type,ev)}}module.exports={on:on,off:off,once:once,emit:emit}},{"synthetic-dom-events":11}],11:[function(require,module,exports){var win=window;var doc=document||{};var root=doc.documentElement||{};var use_key_event=true;try{doc.createEvent("KeyEvents")}catch(err){use_key_event=false}function check_kb(ev,opts){if(ev.ctrlKey!=(opts.ctrlKey||false)||ev.altKey!=(opts.altKey||false)||ev.shiftKey!=(opts.shiftKey||false)||ev.metaKey!=(opts.metaKey||false)||ev.keyCode!=(opts.keyCode||0)||ev.charCode!=(opts.charCode||0)){ev=document.createEvent("Event");ev.initEvent(opts.type,opts.bubbles,opts.cancelable);ev.ctrlKey=opts.ctrlKey||false;ev.altKey=opts.altKey||false;ev.shiftKey=opts.shiftKey||false;ev.metaKey=opts.metaKey||false;ev.keyCode=opts.keyCode||0;ev.charCode=opts.charCode||0}return ev}var modern=function(type,opts){opts=opts||{};var family=typeOf(type);var init_fam=family;if(family==="KeyboardEvent"&&use_key_event){family="KeyEvents";init_fam="KeyEvent"}var ev=doc.createEvent(family);var init_fn="init"+init_fam;var init=typeof ev[init_fn]==="function"?init_fn:"initEvent";var sig=initSignatures[init];var args=[];var used={};opts.type=type;for(var i=0;i<sig.length;++i){var key=sig[i];var val=opts[key];if(val===undefined){val=ev[key]}used[key]=true;args.push(val)}ev[init].apply(ev,args);if(family==="KeyboardEvent"){ev=check_kb(ev,opts)}for(var key in opts){if(!used[key]){ev[key]=opts[key]}}return ev};var legacy=function(type,opts){opts=opts||{};var ev=doc.createEventObject();ev.type=type;for(var key in opts){if(opts[key]!==undefined){ev[key]=opts[key]}}return ev};module.exports=doc.createEvent?modern:legacy;var initSignatures=require("./init.json");var types=require("./types.json");var typeOf=function(){var typs={};for(var key in types){var ts=types[key];for(var i=0;i<ts.length;i++){typs[ts[i]]=key}}return function(name){return typs[name]||"Event"}}()},{"./init.json":12,"./types.json":13}],12:[function(require,module,exports){module.exports={initEvent:["type","bubbles","cancelable"],initUIEvent:["type","bubbles","cancelable","view","detail"],initMouseEvent:["type","bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget"],initMutationEvent:["type","bubbles","cancelable","relatedNode","prevValue","newValue","attrName","attrChange"],initKeyboardEvent:["type","bubbles","cancelable","view","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode"],initKeyEvent:["type","bubbles","cancelable","view","ctrlKey","altKey","shiftKey","metaKey","keyCode","charCode"]}},{}],13:[function(require,module,exports){module.exports={MouseEvent:["click","mousedown","mouseup","mouseover","mousemove","mouseout"],KeyboardEvent:["keydown","keyup","keypress"],MutationEvent:["DOMSubtreeModified","DOMNodeInserted","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMNodeInsertedIntoDocument","DOMAttrModified","DOMCharacterDataModified"],HTMLEvents:["load","unload","abort","error","select","change","submit","reset","focus","blur","resize","scroll"],UIEvent:["DOMFocusIn","DOMFocusOut","DOMActivate"]}},{}],14:[function(require,module,exports){var toCamelCase=require("to-camel-case");module.exports=style;module.exports.hide=effect("display","none");module.exports.show=effect("display","initial");function all(element,css){var name;for(name in css){one(element,name,css[name])}}function effect(name,value){return function(element,override){style(element,name,arguments.length>1?override:value)}}function one(element,name,value){element.style[toCamelCase(name=="float"?"cssFloat":name)]=value}function style(element){if(arguments.length==3){return one(element,arguments[1],arguments[2])}return all(element,arguments[1])}},{"to-camel-case":15}],15:[function(require,module,exports){var toSpace=require("to-space-case");module.exports=toCamelCase;function toCamelCase(string){return toSpace(string).replace(/\s(\w)/g,function(matches,letter){return letter.toUpperCase()})}},{"to-space-case":16}],16:[function(require,module,exports){var clean=require("to-no-case");module.exports=toSpaceCase;function toSpaceCase(string){return clean(string).replace(/[\W_]+(.|$)/g,function(matches,match){return match?" "+match:""})}},{"to-no-case":17}],17:[function(require,module,exports){module.exports=toNoCase;var hasSpace=/\s/;var hasCamel=/[a-z][A-Z]/;var hasSeparator=/[\W_]/;function toNoCase(string){if(hasSpace.test(string))return string.toLowerCase();if(hasSeparator.test(string))string=unseparate(string);if(hasCamel.test(string))string=uncamelize(string);return string.toLowerCase()}var separatorSplitter=/[\W_]+(.|$)/g;function unseparate(string){return string.replace(separatorSplitter,function(m,next){return next?" "+next:""})}var camelSplitter=/(.)([A-Z]+)/g;function uncamelize(string){return string.replace(camelSplitter,function(m,previous,uppers){return previous+" "+uppers.toLowerCase().split("").join(" ")})}},{}],18:[function(require,module,exports){module.exports=parse;var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"];map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"];map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"];map.text=map.circle=map.ellipse=map.line=map.path=map.polygon=map.polyline=map.rect=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"];function parse(html,doc){if("string"!=typeof html)throw new TypeError("String expected");if(!doc)doc=document;var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if(tag=="body"){var el=doc.createElement("html");el.innerHTML=html;return el.removeChild(el.lastChild)}var wrap=map[tag]||map._default;var depth=wrap[0];var prefix=wrap[1];var suffix=wrap[2];var el=doc.createElement("div");el.innerHTML=prefix+html+suffix;while(depth--)el=el.lastChild;if(el.firstChild==el.lastChild){return el.removeChild(el.firstChild)}var fragment=doc.createDocumentFragment();while(el.firstChild){fragment.appendChild(el.removeChild(el.firstChild))}return fragment}},{}],19:[function(require,module,exports){var inserted={};module.exports=function(css,options){if(inserted[css])return;inserted[css]=true;var elem=document.createElement("style");elem.setAttribute("type","text/css");if("textContent"in elem){elem.textContent=css}else{elem.styleSheet.cssText=css}var head=document.getElementsByTagName("head")[0];if(options&&options.prepend){head.insertBefore(elem,head.childNodes[0])}else{head.appendChild(elem)}}},{}],20:[function(require,module,exports){function check(ev,style,shift){var macAllow=!style||style==="mac",winAllow=!style||style==="windows",code=ev.keyCode||ev.which;if(code!==122&&code!==90)return false;if(macAllow&&(ev.metaKey&&shift&&!ev.ctrlKey&&!ev.altKey))return true;if(winAllow&&(ev.ctrlKey&&shift&&!ev.metaKey&&!ev.altKey))return true;return false}module.exports=function(ev,style){return module.exports.undo(ev,style)||module.exports.redo(ev,style)};module.exports.undo=function(ev,style){return check(ev,style,!ev.shiftKey)};module.exports.redo=function(ev,style){return check(ev,style,ev.shiftKey)}},{}],21:[function(require,module,exports){var events=require("dom-events");var tools=require("./tools");var History=require("./history");var deepcopy=require("deepcopy");function passEvent(name,ev){if(this.tool&&this.paths.editable){this.tool[name](ev,this.paths)}}function PathClient(paths,opt){if(!(this instanceof PathClient))return new PathClient(paths,opt);opt=opt||{};this.history=opt.history||History(40);this.paths=paths;this._tool=null;paths.on("finish-change",function(e){this._pushHistory(e)}.bind(this));if(opt.element){["mousedown","mouseup","mousemove"].forEach(function(name){events.on(opt.element,name,passEvent.bind(this,name))}.bind(this))}this.resetHistory()}PathClient.prototype.clear=function(){this.paths.emit("clear-path")};PathClient.prototype._pushHistory=function(e){var type="";if(e)type=e.type;var state=deepcopy(this.paths.state());this.history.push({state:state,type:type})};PathClient.prototype.resetHistory=function(){this.history.reset();this._pushHistory({type:"start"})};PathClient.prototype.undo=function(){var info=this.history.undo();this.paths.state(info.state)};PathClient.prototype.redo=function(){var info=this.history.redo();this.paths.state(info.state)};Object.defineProperty(PathClient.prototype,"tool",{get:function(){return this._tool},set:function(tool){this._tool=tool;this.tool.setup(this.paths)}});module.exports=PathClient},{"./history":22,"./tools":46,deepcopy:24,"dom-events":26}],22:[function(require,module,exports){function History(size){if(!(this instanceof History))return new History(size);this.size=typeof size==="number"?size:40;this.stack=[];this.index=0}History.prototype.push=function(state){if(this.index>0){this.stack.splice(0,this.index);this.index=0}if(this.stack.length<this.size)this.stack.unshift(state);else{this.stack.pop();this.stack.unshift(state)}};History.prototype.undo=function(){this.index++;var max=Math.min(this.stack.length,this.size);if(this.index>max-1)this.index=max-1;return this.stack[this.index]};History.prototype.redo=function(){this.index--;if(this.index<0)this.index=0;return this.stack[this.index]};History.prototype.reset=function(){this.index=0;this.stack.length=0};History.prototype.toString=function(){return this.stack.slice().reverse().map(function(info){return info&&info.type||info}).join(", ")};module.exports=History},{}],23:[function(require,module,exports){var EventEmitter=require("events").EventEmitter;var inherits=require("inherits");var Point=require("./point");var Renderer=require("./renderer");var pointAlongPath=require("./point-along-path");var deepcopy=require("deepcopy");var dist=require("vectors/dist")(2);var sub=require("vectors/sub")(2);var norm=require("vectors/normalize")(2);var add=require("vectors/add")(2);var copy=require("vectors/copy")(2);var mult=require("vectors/mult")(2);function DrawPaths(opt){if(!(this instanceof DrawPaths))return new DrawPaths(opt);EventEmitter.call(this);opt=opt||{};this.renderer=new Renderer(opt);this.points=opt.points||[];this.activePoint=null;this.pointEditDistance=typeof opt.pointEditDistance==="number"?opt.pointEditDistance:10;this.showAllControls=opt.showAllControls;this.drawing=opt.drawing!==false;this.pointOnPathIndex=-1;this.pointOnPath=null;this.allowAdd=opt.allowAdd!==false;this.allowRemove=opt.allowRemove!==false;this.editable=opt.editable!==false;this.closed=opt.closed||false;this.on("add-point",function(e){this.addPoint(e)}.bind(this));this.on("adjust-curve",function(e){var len=dist(e.position,e.point.position);var dir=copy(e.position);norm(sub(dir,e.point.position));mult(dir,-1*len);add(dir,e.point.position);if(e.point.controls.length===1){e.point.curve=true;e.point.controls[0]=dir}else if(e.point.controls.length===2){e.point.curve=true;e.point.controls[1]=e.position;e.point.controls[0]=dir}else throw new Error("unsupported curve order "+e.point.controls.length);this.emit("change")});this.on("mouseup",this._updateActive.bind(this));this.on("mousemove",this._updateActive.bind(this));this.on("close-path",function(e){if(this.points.length<=1)return;this.closed=true;this.emit("change");if(!e||!e.adjusting){this.emit("finish-change",{type:"close-path"})}}.bind(this));this.on("move-shape",function(e){var point=this.activePoint;if(!point||point.isControl)return;var old=point.position;var translate=sub(copy(e.position),old);this.points.forEach(function(p){translatePoint(p,translate)});this.emit("change")}.bind(this));this.on("move-active",function(e){var point=this.activePoint;if(!point)return;if(point.isControl&&point.parent){point.parent.controls[point.index]=e.position;point.position=e.position}else{var old=point.position;var translate=sub(copy(e.position),old);translatePoint(point,translate)}this.emit("change")}.bind(this));this.on("remove-point",function(e){if(!e.point)return;var idx=this.points.indexOf(e.point);if(idx===-1)return;this.points.splice(idx,1);if(this.activePoint===e.point)this.activePoint=null;this.emit("change");this.emit("finish-change",{type:"remove-point"});if(this.points.length<=2)this.closed=false}.bind(this));this.on("clear-path",function(e){this.clear();this.emit("change");this.emit("finish-change",{type:"clear-path"})}.bind(this))}function translatePoint(point,amount){add(point.position,amount);for(var j=0;j<point.controls.length;j++){var c=point.controls[j];add(c,amount)}}inherits(DrawPaths,EventEmitter);DrawPaths.prototype.addPoint=function(e){var point=new Point(e.position);if(typeof e.index==="number"){this.points.splice(e.index,0,point);this._updateActive(e)}else this.points.push(point);this.emit("change");if(!e.adjusting){this.emit("finish-change",{type:"add-point"})}};DrawPaths.prototype._updateActive=function(e){if(!e){this.activePoint=null;this.pointOnPath=null;this.pointOnPathIndex=null;return}var closest=this.nearestPoint(e.position,this.pointEditDistance);this.activePoint=closest;if(!closest){this.activePoint=this.nearestControl(e.position,this.pointEditDistance);if(this.activePoint&&!this.controlsVisible(this.activePoint.pointIndex))this.activePoint=null}this.pointOnPath=[0,0];this.pointOnPathIndex=pointAlongPath(this.points,this.closed,e.position,this.pointEditDistance,this.pointOnPath);if(this.pointOnPathIndex===-1)this.pointOnPath=null;if(this.activePoint&&this.pointOnPath){this.pointOnPath=null;this.pointOnPathIndex=-1}};DrawPaths.prototype.nearestPointIndex=function(position,threshold){threshold=typeof threshold==="number"?threshold:Number.MAX_VALUE;var nearestIndex=-1;var minDist=Number.MAX_VALUE;for(var i=0;i<this.points.length;i++){var p=this.points[i];var distance=dist(p.position,position);if(distance<minDist&&distance<threshold){nearestIndex=i;minDist=distance}}return nearestIndex};DrawPaths.prototype.nearestPoint=function(position,threshold){var idx=this.nearestPointIndex(position,threshold);return idx===-1?null:this.points[idx]};DrawPaths.prototype.nearestControl=function(position,threshold){threshold=typeof threshold==="number"?threshold:Number.MAX_VALUE;var nearest=null;var associatedPoint=null;var minDist=Number.MAX_VALUE;var controlIndex=-1;var pointIndex=-1;for(var i=0;i<this.points.length;i++){var p=this.points[i];for(var j=0;j<p.controls.length;j++){var distance=dist(p.controls[j],position);if(distance<minDist&&distance<threshold){nearest=p.controls[j];associatedPoint=p;pointIndex=i;controlIndex=j;minDist=distance}}}return nearest?{isControl:true,position:nearest,index:controlIndex,pointIndex:pointIndex,parent:associatedPoint}:null};DrawPaths.prototype.lastPoint=function(){return this.points[this.points.length-1]};DrawPaths.prototype.firstPoint=function(){return this.points[0]};DrawPaths.prototype.controlsVisible=function(pointIndex){if(!this.drawing)return false;var point=this.points[pointIndex];if(!point||!point.curve)return false;if(pointIndex===this.points.length-1&&!this.closed)return true;var active=this.activePoint;if(point===active)return true;return this.showAllControls};DrawPaths.prototype.state=function(state){if(state){state=deepcopy(state);this.points=state.points;this.closed=state.closed;this._updateActive()}else return{points:this.points,closed:this.closed}};DrawPaths.prototype.draw=function(ctx){this.renderer.showPointOnPath=this.allowAdd;this.renderer.draw(this,ctx,this.state(),this.activePoint)};DrawPaths.prototype.clear=function(){this.points.length=0;this.closed=false;this.activePoint=null};module.exports=DrawPaths},{"./point":44,"./point-along-path":43,"./renderer":45,deepcopy:24,events:48,inherits:30,"vectors/add":35,"vectors/copy":36,"vectors/dist":37,"vectors/mult":39,"vectors/normalize":40,"vectors/sub":41}],24:[function(require,module,exports){module.exports=require("./lib/deepcopy")},{"./lib/deepcopy":25}],25:[function(require,module,exports){(function(){var util=typeof module!=="undefined"?require("util"):function(){var to=Object.prototype.toString;function isArray(value){return typeof value==="object"&&to.call(value)==="[object Array]"}function isDate(value){return typeof value==="object"&&to.call(value)==="[object Date]"}function isRegExp(value){return typeof value==="object"&&to.call(value)==="[object RegExp]"}return{isArray:Array.isArray||isArray,isDate:isDate,isRegExp:isRegExp}}();var getKeys=Object.keys||function(object){var keys=[],key;if(object===null||typeof object!=="object"){throw new TypeError("parameter type is not an Object")}for(key in object){object.hasOwnProperty(key)&&keys.push(key)}return keys};function indexOfArray(array,searchElement){var i,len;if(!util.isArray(array)){throw new TypeError("parameter type is not an Array")}for(i=0,len=array.length;i<len;++i){if(array[i]===searchElement){return i}}return-1}function deepcopy(target){var clone=util.isArray(target)?[]:{},visited=[target],ref=[clone];function deepcopy_(target,clone,visited,ref){var keys,i,len,key,value,index,object,reference;if(target===null||typeof target!=="object"){return target}if(util.isDate(target)){return new Date(Number(target))}if(util.isRegExp(target)){return new RegExp(target.source,String(target).slice(target.source.length+2))}keys=getKeys(target);for(i=0,len=keys.length;i<len;++i){key=keys[i];value=target[key];if(value!==null&&typeof value==="object"){index=indexOfArray(visited,value);if(index===-1){object=util.isArray(value)?[]:{};visited.push(value);ref.push(object)}else{reference=ref[index]}}clone[key]=reference||deepcopy_(value,object,visited,ref);index=object=reference=null}return clone}return deepcopy_(target,clone,visited,ref)}if(typeof module!=="undefined"){module.exports=deepcopy}else{this.deepcopy=deepcopy}})()},{util:52}],26:[function(require,module,exports){module.exports=require(10)},{"synthetic-dom-events":27}],27:[function(require,module,exports){module.exports=require(11)},{"./init.json":28,"./types.json":29}],28:[function(require,module,exports){module.exports=require(12)},{}],29:[function(require,module,exports){module.exports=require(13)},{}],30:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;
ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],31:[function(require,module,exports){var pointCircleCollide=require("point-circle-collision");var tmp=[0,0];function lineCircleCollide(a,b,circle,radius,nearest){if(pointCircleCollide(a,circle,radius)){if(nearest){nearest[0]=a[0];nearest[1]=a[1]}return true}if(pointCircleCollide(b,circle,radius)){if(nearest){nearest[0]=b[0];nearest[1]=b[1]}return true}var x1=a[0],y1=a[1],x2=b[0],y2=b[1],cx=circle[0],cy=circle[1];var dx=x2-x1;var dy=y2-y1;var lcx=cx-x1;var lcy=cy-y1;var dLen2=dx*dx+dy*dy;var px=dx;var py=dy;if(dLen2>0){var dp=(lcx*dx+lcy*dy)/dLen2;px*=dp;py*=dp}if(!nearest)nearest=tmp;nearest[0]=x1+px;nearest[1]=y1+py;var pLen2=px*px+py*py;return pointCircleCollide(nearest,circle,radius)&&pLen2<=dLen2&&px*dx+py*dy>=0}module.exports=lineCircleCollide},{"point-circle-collision":32}],32:[function(require,module,exports){function pointCircleCollision(point,circle,r){if(r===0)return false;var dx=circle[0]-point[0];var dy=circle[1]-point[1];return dx*dx+dy*dy<=r*r}module.exports=pointCircleCollision},{}],33:[function(require,module,exports){module.exports=function offset(ev,options){ev=ev||window.event;var target=ev.target||ev.srcElement;var rect=options&&options.clientRect||target.getBoundingClientRect(),clientX=options&&options.clientX,clientY=options&&options.clientY;clientX=typeof clientX==="number"?clientX:ev.clientX;clientY=typeof clientY==="number"?clientY:ev.clientY;return{x:clientX-rect.left,y:clientY-rect.top}}},{}],34:[function(require,module,exports){module.exports=require(32)},{}],35:[function(require,module,exports){module.exports=require("./lib/operator")("add","+")},{"./lib/operator":38}],36:[function(require,module,exports){module.exports=function(){return copy};function copy(vec){return vec.slice(0)}},{}],37:[function(require,module,exports){module.exports=generator;function generator(dims){dims=+dims|0;var body=[];body.push("return function dist"+dims+"(vec, other) {");var els=[];for(var i=0;i<dims;i+=1){body.push("var p"+i+" = other["+i+"]-vec["+i+"]");els.push("p"+i+"*p"+i)}body.push("return Math.sqrt("+els.join(" + ")+")");body.push("}");return Function(body.join("\n"))()}},{}],38:[function(require,module,exports){module.exports=operator;function operator(name,op){return function generator(dims,opts){dims=+dims|0;opts=opts||{};var scalars="scalars"in opts?opts.scalars:true;var vectors="vectors"in opts?opts.vectors:true;var both=scalars&&vectors;var body=[];if(!scalars&&!vectors)throw new Error("Your function must accept either scalars or vectors");body.push("return function "+name+dims+"(vec) {");body.push("var i = arguments.length");body.push("while (--i) {");if(both)body.push("if (Array.isArray(arguments[i])) {");if(vectors){for(var i=0;i<dims;i+=1){body.push("vec["+i+"] "+op+"= arguments[i]["+i+"]")}}if(both)body.push("} else {");if(scalars){for(var i=0;i<dims;i+=1){body.push("vec["+i+"] "+op+"= arguments[i]")}}if(both)body.push("}");body.push("}");body.push("return vec");body.push("}");return Function(body.join("\n"))()}}},{}],39:[function(require,module,exports){module.exports=require("./lib/operator")("mult","*")},{"./lib/operator":38}],40:[function(require,module,exports){module.exports=generator;function generator(dims){dims=+dims|0;var body=[];body.push("return function normalize"+dims+"(vec, scalar) {");var els=[];for(var i=0;i<dims;i+=1){els.push("vec["+i+"]*vec["+i+"]")}body.push("var mag = Math.sqrt("+els.join("+")+")");body.push("if (mag === 0) {");for(var i=0;i<dims;i+=1){body.push("vec["+i+"] = 0")}body.push("} else {");for(var i=0;i<dims;i+=1){body.push("vec["+i+"] /= mag")}body.push("}");body.push("return vec");body.push("}");return Function(body.join("\n"))()}},{}],41:[function(require,module,exports){module.exports=require("./lib/operator")("sub","-")},{"./lib/operator":38}],42:[function(require,module,exports){var insideCircle=require("point-circle-collision");var tmp=[0,0];var nearest=[0,0];var copy=require("vectors/copy")(2);function distSq(point,circle){var dx=circle[0]-point[0];var dy=circle[1]-point[1];return dx*dx+dy*dy}module.exports.bezier=function alongBezier(start,c1,c2,end,point,radius,steps){var x1=start[0],y1=start[1],x2=c1[0],y2=c1[1],x3=c2[0],y3=c2[1],x4=end[0],y4=end[1],minDist=Number.MAX_VALUE,hasPoint=false;for(var i=0;i<steps;i++){var t=i/(steps-1);var dt=1-t;var dt2=dt*dt;var dt3=dt2*dt;var t2=t*t;var t3=t2*t;tmp[0]=dt3*x1+3*dt2*t*x2+3*dt*t2*x3+t3*x4;tmp[1]=dt3*y1+3*dt2*t*y2+3*dt*t2*y3+t3*y4;var distFromCircleSq=distSq(point,tmp);if(distFromCircleSq<radius*radius&&distFromCircleSq<minDist){hasPoint=true;nearest[0]=tmp[0];nearest[1]=tmp[1];minDist=distFromCircleSq}}if(hasPoint)return copy(nearest);return null};module.exports.quadratic=function alongQuadratic(start,c1,end,point,radius,steps){var x1=start[0],y1=start[1],x2=c1[0],y2=c1[1],x3=end[0],y3=end[1],minDist=Number.MAX_VALUE,hasPoint=false;for(var i=0;i<steps;i++){var t=i/(steps-1);var dt=1-t;var dtSq=dt*dt;var tSq=t*t;tmp[0]=dtSq*x1+2*dt*t*x2+tSq*x3;tmp[1]=dtSq*y1+2*dt*t*y2+tSq*y3;var distFromCircleSq=distSq(point,tmp);if(distFromCircleSq<radius*radius&&distFromCircleSq<minDist){hasPoint=true;nearest[0]=tmp[0];nearest[1]=tmp[1];minDist=distFromCircleSq}}if(hasPoint)return copy(nearest);return null}},{"point-circle-collision":34,"vectors/copy":36}],43:[function(require,module,exports){var collide=require("line-circle-collision");var curve=require("./point-along-curve");module.exports=function(path,closed,point,radius,nearest){var steps=100;if(path.length<=1)return-1;for(var i=0;i<path.length;i++){var cur=path[i];var last=null;var hit=false;var curvePoint=null;if(!closed&&i===0)continue;if(closed&&i===0){last=path[path.length-1]}else last=path[i-1];if(!last.curve&&!cur.curve){hit=collide(last.position,cur.position,point,radius,nearest)}else{if(last.curve&&cur.curve){var c1=last.controls[1],c2=cur.controls[0];curvePoint=curve.bezier(last.position,c1,c2,cur.position,point,radius,steps)}else{if(closed&&i===0&&last.curve){var c1=last.controls[1];curvePoint=curve.quadratic(last.position,c1,cur.position,point,radius,steps)}else{var c1=last.curve?last.controls[1]:cur.controls[0];curvePoint=curve.quadratic(last.position,c1,cur.position,point,radius,steps)}}}if(curvePoint){nearest[0]=curvePoint[0];nearest[1]=curvePoint[1];hit=true}if(hit)return i}return-1}},{"./point-along-curve":42,"line-circle-collision":31}],44:[function(require,module,exports){function Point(position){this.position=position||[0,0];this.controls=[[0,0],[0,0]];this.curve=false}module.exports=Point},{}],45:[function(require,module,exports){var dist=require("vectors/dist")(2);var copy=require("vectors/copy")(2);function Renderer(opt){opt=opt||{};this.showPointOnPath=true;this.pointRadius=typeof opt.pointRadius==="number"?opt.pointRadius:3;this.controlRadius=typeof opt.controlRadius==="number"?opt.controlRadius:2;this.controlAlpha=typeof opt.controlAlpha==="number"?opt.controlAlpha:.2;this.controlStyle=opt.controlStyle||"blue";this.pointStyle=opt.pointStyle||"#2d2d2d";this.drawingPointStyle=opt.drawingPointStyle||"white";this.highlightAlpha=typeof opt.highlightAlpha==="number"?opt.highlightAlpha:.5;this.stroke=opt.stroke!==false;this.fill=opt.fill!==false;this.showEditingPoints=opt.showEditingPoints!==false;this.controlLineWidth=typeof opt.controlLineWidth==="number"?opt.controlLineWidth:1;this.lineWidth=typeof opt.lineWidth==="number"?opt.lineWidth:2;this.strokeStyle=opt.strokeStyle||this.pointStyle;this.strokeAlpha=typeof opt.strokeAlpha==="number"?opt.strokeAlpha:.5;this.fillStyle=opt.fillStyle||this.pointStyle;this.fillAlpha=typeof opt.fillAlpha==="number"?opt.fillAlpha:.5}Renderer.prototype.drawPath=function(parent,ctx,path){var points=path.points,closed=path.closed;for(var i=0;i<points.length;i++){var p=points[i];var pos=p.position;if(i===0)ctx.moveTo(pos[0],pos[1]);var last=i>0?points[i-1]:null;var lastCurve=last&&last.curve;var curve=p.curve;if(i===0&&points.length>1&&closed){last=points[points.length-1];lastCurve=last.curve;ctx.moveTo(last.position[0],last.position[1]);if(!lastCurve&&p.curve){var c1=p.controls[0];ctx.quadraticCurveTo(c1[0],c1[1],pos[0],pos[1])}}if(last&&lastCurve&&curve){var c1=last.controls[1],c2=p.controls[0];ctx.bezierCurveTo(c1[0],c1[1],c2[0],c2[1],pos[0],pos[1])}else if(last&&lastCurve){var c1=last.controls[1];ctx.quadraticCurveTo(c1[0],c1[1],pos[0],pos[1])}else if(curve&&i>0){var c1=p.controls[0];ctx.quadraticCurveTo(c1[0],c1[1],pos[0],pos[1])}else ctx.lineTo(pos[0],pos[1])}};Renderer.prototype.drawHighlight=function(parent,ctx,path,active){if(active){var pos=active.position;var isControl=active.isControl;if(isControl&&!parent.controlsVisible(active.pointIndex))return;var isClosing=!isControl&&path.points.length>2&&active===path.points[0]&&!parent.closed;var radius=isControl?this.controlRadius:this.pointRadius;ctx.globalAlpha=isControl?this.controlAlpha:this.highlightAlpha;ctx.beginPath();ctx.lineWidth=this.lineWidth;ctx.arc(pos[0],pos[1],radius+4,0,Math.PI*2,false);if(isClosing){ctx.strokeStyle=this.pointStyle;ctx.stroke()}else{ctx.fillStyle=isControl?this.controlStyle:this.pointStyle;ctx.fill()}}if(parent.pointOnPath&&this.showPointOnPath){var pos=parent.pointOnPath;ctx.beginPath();ctx.globalAlpha=this.highlightAlpha;ctx.strokeStyle=this.pointStyle;ctx.arc(pos[0],pos[1],this.pointRadius,0,Math.PI*2,false);ctx.stroke()}};Renderer.prototype.drawControlPoints=function(parent,ctx,path,active){var points=path.points,closed=path.closed;var radius=this.pointRadius,controlStyle=this.controlStyle,controlAlpha=this.controlAlpha,pointStyle=this.pointStyle;ctx.beginPath();for(var i=0;i<points.length;i++){if(!points[i].curve)continue;if(!parent.controlsVisible(i))continue;var pos=points[i].position;var controls=points[i].controls;for(var j=0;j<controls.length;j++){var p=controls[j];ctx.moveTo(pos[0],pos[1]);ctx.lineTo(p[0],p[1])}}ctx.globalAlpha=controlAlpha;ctx.lineWidth=this.controlLineWidth;ctx.strokeStyle=controlStyle;ctx.stroke();ctx.beginPath();for(var i=0;i<points.length;i++){if(!points[i].curve)continue;if(!parent.controlsVisible(i))continue;var controls=points[i].controls;for(var j=0;j<controls.length;j++){var p=controls[j];ctx.moveTo(p[0],p[1]);ctx.arc(p[0],p[1],radius,0,Math.PI*2,false)}}ctx.globalAlpha=controlAlpha;ctx.fillStyle=controlStyle;ctx.fill()};Renderer.prototype.drawEditingPath=function(parent,ctx,path,active){var points=path.points,closed=path.closed;var radius=this.pointRadius,controlStyle=this.controlStyle,controlAlpha=this.controlAlpha;pointStyle=this.pointStyle;this.drawControlPoints(parent,ctx,path,active);ctx.beginPath();this.drawPath(parent,ctx,path);ctx.lineWidth=this.lineWidth;ctx.globalAlpha=this.strokeAlpha;ctx.strokeStyle=this.strokeStyle;ctx.stroke();ctx.beginPath();for(var i=0;i<points.length;i++){var p=points[i].position;if(!closed&&i===points.length-1)continue;ctx.moveTo(p[0],p[1]);ctx.arc(p[0],p[1],radius,0,Math.PI*2,false)}ctx.globalAlpha=1;ctx.fillStyle=pointStyle;ctx.fill();if(points.length>0&&!closed){ctx.beginPath();var p=points[points.length-1].position;if(parent.drawing)ctx.rect(p[0]-radius,p[1]-radius,radius*2,radius*2);else ctx.arc(p[0],p[1],radius,0,Math.PI*2,false);ctx.globalAlpha=1;if(parent.drawing){ctx.strokeStyle=pointStyle;ctx.fillStyle=this.drawingPointStyle;ctx.fill();ctx.lineWidth=1;ctx.stroke()}else{ctx.fillStyle=pointStyle;ctx.fill()}}};Renderer.prototype.draw=function(parent,ctx,path,active){ctx.globalAlpha=1;if(path.closed&&(this.fill||this.stroke)){ctx.beginPath();this.drawPath(parent,ctx,path);ctx.globalAlpha=this.fillAlpha;ctx.fillStyle=this.fillStyle;if(this.fill){ctx.fillStyle=this.fillStyle;ctx.globalAlpha=this.fillAlpha;ctx.fill()}if(this.stroke){ctx.globalAlpha=this.strokeAlpha;ctx.strokeStyle=this.strokeStyle;ctx.stroke()}}if(this.showEditingPoints){this.drawEditingPath(parent,ctx,path,active);this.drawHighlight(parent,ctx,path,active)}};module.exports=Renderer},{"vectors/copy":36,"vectors/dist":37}],46:[function(require,module,exports){module.exports=[require("./multitool")]},{"./multitool":47}],47:[function(require,module,exports){var offset=require("mouse-event-offset");var dist=require("vectors/dist")(2);module.exports=function(opt){opt=opt||{};if(typeof opt.curveStartDistance!=="number")opt.curveStartDistance=15;var dragging=false,dragButton=0,startedCurve=false,adjustEventType=null;return{name:"multitool",description:"multi purpose path drawing",setup:function(paths){this.moveDirect=true},mousedown:function(ev,paths){ev.preventDefault();var off=offset(ev);var pos=[off.x,off.y];var dragStart=false;adjustEventType=null;var moveKey=ev.ctrlKey||ev.metaKey;var shouldClose=moveKey&&ev.shiftKey&&paths.points.length>2;var addLinePoint=paths.pointOnPath&&paths.allowAdd&&!paths.activePoint;if(!moveKey&&paths.drawing&&paths.activePoint&&!paths.activePoint.isControl&&!paths.closed&&paths.points.length>2&&paths.activePoint===paths.points[0]){shouldClose=true}if(!paths.drawing&&(moveKey||!this.moveDirect)){dragStart=true;paths.emit("move-shape",{position:pos})}else if(paths.drawing&&paths.activePoint&&!paths.activePoint.isControl&&paths.allowRemove&&ev.altKey){paths.emit("remove-point",{point:paths.activePoint})}else if(shouldClose&&!paths.closed&&paths.drawing){paths.emit("close-path",{adjusting:true});dragStart=true;adjustEventType="close-path"}else if(paths.activePoint){dragStart=paths.points.length>=0;adjustEventType=dragStart?"adjust-curve":"move-active";if(moveKey){if(this.moveDirect)paths.emit("move-active",{position:pos})}else if(!paths.activePoint.isControl&&paths.drawing){paths.activePoint.curve=false}}else if(!moveKey&&(!paths.closed&&paths.drawing||addLinePoint)){dragStart=!addLinePoint&&paths.points.length>=0;adjustEventType=dragStart?"add-point":"add-point";paths.emit("add-point",{adjusting:dragStart,position:addLinePoint?paths.pointOnPath:pos,index:addLinePoint?paths.pointOnPathIndex:undefined})}if(dragStart){dragging=true;dragButton=ev.button;startedCurve=false}},mousemove:function(ev,paths){ev.preventDefault();var off=offset(ev);var pos=[off.x,off.y];if(ev.button===dragButton&&dragging){var moveKey=ev.ctrlKey||ev.metaKey;var lastPoint=paths.lastPoint();var makingCurve=paths.activePoint&&!paths.activePoint.isControl&&!moveKey&&paths.drawing;if(makingCurve){startedCurve=true;lastPoint=paths.activePoint}if(!paths.drawing&&(moveKey||!this.moveDirect)){adjustEventType="move-shape";paths.emit("move-shape",{position:pos})}else if(!makingCurve&&paths.activePoint){if(this.moveDirect){adjustEventType="move-active";paths.emit("move-active",{position:pos})}}else{if(!startedCurve){if(dist(lastPoint.position,pos)<opt.curveStartDistance)return;startedCurve=true}paths.emit("adjust-curve",{point:lastPoint,position:pos})}}else if(!dragging){paths.emit("mousemove",{position:[off.x,off.y]})}},mouseup:function(ev,paths){if(ev.button===dragButton){if(dragging){paths.emit("finish-change",{type:adjustEventType})}dragging=false}var off=offset(ev);var pos=[off.x,off.y];paths.emit("mouseup",{position:pos})}}}},{"mouse-event-offset":33,"vectors/dist":37}],48:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{throw TypeError('Uncaught, unspecified "error" event.')}return false}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],49:[function(require,module,exports){module.exports=require(30)},{}],50:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],51:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],52:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("UPikzY"),typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":51,UPikzY:50,inherits:49}]},{},[1]);